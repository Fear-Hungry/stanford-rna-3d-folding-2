{
  "id": "EXP-101-E31",
  "tag": "e31_hybrid_select_minimize_openmm",
  "description": "Hybrid router + Top-5 + minimizacao OpenMM antes de export/submission.",
  "variables": {
    "targets_csv": "input/stanford-rna-3d-folding-2/test_sequences.csv",
    "sample_submission": "input/stanford-rna-3d-folding-2/sample_submission.csv",
    "ground_truth": "input/stanford-rna-3d-folding-2/validation_labels.csv",
    "usalign_bin": "src/rna3d_local/evaluation/USalign",
    "retrieval_candidates": "runs/retrieval/retrieval_candidates.parquet",
    "tbm_predictions": "runs/tbm/predictions.parquet",
    "rnapro_predictions": "runs/phase2/rnapro.parquet",
    "chai1_predictions": "runs/phase2/chai1.parquet",
    "boltz1_predictions": "runs/phase2/boltz1.parquet",
    "se3_flash_predictions": "runs/se3/top5_flash.parquet",
    "se3_mamba_predictions": "runs/se3/top5_mamba.parquet",
    "template_score_threshold": "0.65",
    "short_max_len": "350",
    "medium_max_len": "600",
    "n_models": "5",
    "min_backend": "openmm",
    "bond_length_angstrom": "5.9",
    "bond_force_k": "60.0",
    "angle_force_k": "8.0",
    "angle_target_deg": "120.0",
    "vdw_min_distance_angstrom": "2.1",
    "vdw_epsilon": "0.20",
    "position_restraint_k": "800.0",
    "usalign_timeout": "900",
    "ground_truth_mode": "best_of_gt_copies"
  },
  "steps": [
    {
      "name": "hybrid_router",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "build-hybrid-candidates",
        "--targets",
        "{targets_csv}",
        "--retrieval",
        "{retrieval_candidates}",
        "--tbm",
        "{tbm_predictions}",
        "--rnapro",
        "{rnapro_predictions}",
        "--chai1",
        "{chai1_predictions}",
        "--boltz1",
        "{boltz1_predictions}",
        "--se3-flash",
        "{se3_flash_predictions}",
        "--se3-mamba",
        "{se3_mamba_predictions}",
        "--out",
        "{run_dir}/hybrid_candidates.parquet",
        "--routing-out",
        "{run_dir}/routing.parquet",
        "--template-score-threshold",
        "{template_score_threshold}",
        "--short-max-len",
        "{short_max_len}",
        "--medium-max-len",
        "{medium_max_len}"
      ]
    },
    {
      "name": "select_top5",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "select-top5-hybrid",
        "--candidates",
        "{run_dir}/hybrid_candidates.parquet",
        "--out",
        "{run_dir}/hybrid_top5.parquet",
        "--n-models",
        "{n_models}"
      ]
    },
    {
      "name": "minimize",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "minimize-ensemble",
        "--predictions",
        "{run_dir}/hybrid_top5.parquet",
        "--out",
        "{run_dir}/hybrid_top5_minimized.parquet",
        "--backend",
        "{min_backend}",
        "--bond-length-angstrom",
        "{bond_length_angstrom}",
        "--bond-force-k",
        "{bond_force_k}",
        "--angle-force-k",
        "{angle_force_k}",
        "--angle-target-deg",
        "{angle_target_deg}",
        "--vdw-min-distance-angstrom",
        "{vdw_min_distance_angstrom}",
        "--vdw-epsilon",
        "{vdw_epsilon}",
        "--position-restraint-k",
        "{position_restraint_k}"
      ]
    },
    {
      "name": "export",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "export-submission",
        "--sample",
        "{sample_submission}",
        "--predictions",
        "{run_dir}/hybrid_top5_minimized.parquet",
        "--out",
        "{run_dir}/submission.csv"
      ]
    },
    {
      "name": "check",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "check-submission",
        "--sample",
        "{sample_submission}",
        "--submission",
        "{run_dir}/submission.csv"
      ]
    },
    {
      "name": "score",
      "argv": [
        "python",
        "-m",
        "rna3d_local",
        "score-local-bestof5",
        "--ground-truth",
        "{ground_truth}",
        "--submission",
        "{run_dir}/submission.csv",
        "--usalign-bin",
        "{usalign_bin}",
        "--timeout-seconds",
        "{usalign_timeout}",
        "--ground-truth-mode",
        "{ground_truth_mode}",
        "--score-json",
        "{run_dir}/score.json",
        "--report",
        "{run_dir}/score_report.json"
      ]
    }
  ],
  "artifacts": [
    "{run_dir}/submission.csv",
    "{run_dir}/score.json",
    "{run_dir}/routing.parquet"
  ]
}
